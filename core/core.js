!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=14)}([function(t,e,n){(function(e){t.exports=function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&f(t,e)}function u(t){var e="function"==typeof Map?new Map:void 0;return(u=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return s(t,arguments,l(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),f(r,t)})(t)}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function s(t,e,n){return(s=c()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&f(i,n.prototype),i}).apply(null,arguments)}function f(t,e){return(f=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}n.r(e);var h=function(t){function e(t){return i(this,e),o(this,l(e).call(this,t))}return a(e,t),e}(u(Error)),p=function(t){function e(t){return i(this,e),o(this,l(e).call(this,t))}return a(e,t),e}(u(Error)),v=function(t){function e(t,n,r){var a;i(this,e);var u="No viable match in '".concat(t,"...'");return(a=o(this,l(e).call(this,u))).name="UnmatchedCharacterException",a.displayable=!0,a.line=n,a.character=r,a}return a(e,t),e}(p),m=function(t){function e(t){var n;return i(this,e),(n=o(this,l(e).call(this,t))).name="ParserException",n}return a(e,t),e}(u(Error)),b=function(t){function e(t,n){var r;i(this,e);var a="Expected ".concat(t," but found ").concat(n.type);return(r=o(this,l(e).call(this,a))).name="UnexpectedTokenException",r.displayable=!0,r.line=n.line,r.character=n.character,r.length="".concat(n.content).length,r}return a(e,t),e}(m);function d(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var y=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n;return e=t,(n=[{key:"initialize",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t)throw new m("No tokens provided to the parser");if(!(t instanceof Array))throw new m("A non-array was provided to the parser instead of a token array");this.debug=e.debug||!1,this.testing=e.testing||!1,this.tokens=t}},{key:"la1",value:function(t){if(this.eof())throw new m("No tokens available");return this.tokens[0].type==t}},{key:"peek",value:function(){if(this.eof())throw new m("No tokens available");return this.tokens[0]}},{key:"match",value:function(t){if(this.eof())throw new m("Expected ".concat(t," but found EOF"));if(!this.la1(t))throw new b(t,this.tokens[0]);return this.tokens.shift()}},{key:"next",value:function(){if(this.eof())throw new m("Expected token but found EOF");return this.tokens.shift()}},{key:"eof",value:function(){return 0===this.tokens.length}},{key:"expectEof",value:function(){if(!this.eof())throw new b("EOF",this.tokens[0])}},{key:"resetStream",value:function(t){for(;!this.eof()&&!this.la1(t);)this.tokens.shift();!this.eof()&&this.la1(t)&&this.tokens.shift()}},{key:"position",value:function(){return this.testing?{}:{line:this.tokens[0].line,character:this.tokens[0].character}}},{key:"tokenPosition",value:function(t){return this.testing?{}:{line:t.line,character:t.character}}},{key:"debugLog",value:function(t){this.debug&&console.log(t)}}])&&d(e.prototype,n),t}();function g(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var k=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.line=1,this.character=1,this.justSeenSlashR=!1}var e,n;return e=t,(n=[{key:"consume",value:function(t){for(var e=0,n=t.length;e<n;e++)"\r"==t[e]?(this.line+=1,this.character=1,this.justSeenSlashR=!0):"\n"==t[e]?(this.justSeenSlashR||(this.line+=1),this.character=1,this.justSeenSlashR=!1):(this.character+=1,this.justSeenSlashR=!1)}}])&&g(e.prototype,n),t}();function x(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var w=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.tokenTypes=[]}var e,n;return e=t,(n=[{key:"addTokenType",value:function(t){if(!t.name)throw new h("Token types must have a 'name' property");if(!t.regexp&&!t.consume)throw new h("Token types must have a 'regexp' property or a 'consume' function");if(t.regexp&&!(t.regexp instanceof RegExp))throw new h("Token types 'regexp' property must be an instance of RegExp");if(t.consume&&"function"!=typeof t.consume)throw new h("Token types 'consume' property must be a function");if(t.interpret&&"function"!=typeof t.interpret)throw new h("Token types 'interpret' property must be a function");this.tokenTypes.push(t)}},{key:"tokenize",value:function(t){if(void 0===t)throw new p("No content provided");if(0===this.tokenTypes.length)throw new p("No token types defined");for(var e,n,r=[],i=[],o=t,a=new k,u=this.tokenTypes.length;o.length>0;){for(var c=!1,s=0;s<u;s++){var f=this.tokenTypes[s];if(n=void 0,f.consume){if(!(n=f.consume(o)).success)continue;if(0!==o.indexOf(n.consumed))throw new p("The consume function for ".concat(f.name," failed to return the start of the remaining content at ").concat(a.line,".").concat(a.character," and instead returned ").concat(n.consumed));c=!0,e=n.consumed}else{var l=f.regexp.exec(o);if(!l)continue;if(0!==l.index)continue;c=!0,e=l[0]}var h={content:t=f.interpret?f.interpret(e):n&&null!=n.content?n.content:e,type:f.name,line:a.line,character:a.character};f.ignore||r.push(h),o=o.substring(e.length),a.consume(e);break}if(!c){var m=o.substring(0,15).replace("\r","\\r").replace("\t","\\t").replace("\n","\\n");i.push(new v(m,a.line,a.character)),a.consume(o.charAt(0)),o=o.substring(1)}}return{tokens:r,errors:i}}}])&&x(e.prototype,n),t}();function E(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var S=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n;return e=t,(n=[{key:"constant",value:function(t,e){return{name:e,regexp:new RegExp("^".concat((n=t,n.replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1"))))};var n}},{key:"floatingPoint",value:function(){return{name:"floating point",regexp:/(^-?\d*\.\d+)/,interpret:function(t){return parseFloat(t)}}}},{key:"integer",value:function(){return{name:"integer",regexp:/^-?\d+/,interpret:function(t){return parseInt(t)}}}},{key:"whitespace",value:function(){return{name:"whitespace",ignore:!0,regexp:/^[ \t]+/}}},{key:"whitespaceWithNewlines",value:function(){return{name:"whitespace",ignore:!0,regexp:/^[ \t\r\n]+/}}},{key:"real",value:function(){return{name:"real number",regexp:/^X/}}},{key:"comma",value:function(){return this.constant(",","comma")}},{key:"period",value:function(){return this.constant(".","period")}},{key:"star",value:function(){return this.constant("*","star")}},{key:"colon",value:function(){return this.constant(":","colon")}},{key:"openParen",value:function(){return this.constant("(","open paren")}},{key:"closeParen",value:function(){return this.constant(")","close paren")}},{key:"openBracket",value:function(){return this.constant("{","open bracket")}},{key:"closeBracket",value:function(){return this.constant("}","close bracket")}},{key:"openSquareBracket",value:function(){return this.constant("[","open square bracket")}},{key:"closeSquareBracket",value:function(){return this.constant("]","close square bracket")}},{key:"JsonString",value:function(){return{name:"string",regexp:/"(?:[^"\\]|\\.)*"/,consume:function(t){var e={success:!1};if(0!==t.indexOf('"'))return e;var n,r="",i=1,o=!1;do{n=t[i],i+=1;var a=void 0,u=void 0;switch(n){case'"':o=!0;break;case"\\":switch(a=t[i],i+=1,a){case'"':return e;case"t":r+="\t";break;case"r":r+="\r";break;case"n":r+="\n";break;case"u":if(4==(u=t.substr(i,4)).length&&/\d{4}/.test(u)){i+=4;var c=parseInt(u,10);r+=String.fromCharCode(c)}else r+="\\u";break;default:return e}break;default:r+=n}}while(!o);return{success:!0,consumed:t.substring(0,i),content:r}}}}}])&&E(e,n),t}();function T(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function A(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var R=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};T(this,t),this.operatorStack=[],this.output=[],this.precedences=e,this.astConstructor=n.astConstructor||this.defaultAstConstructor}var e,n;return e=t,(n=[{key:"defaultAstConstructor",value:function(t,e,n){return{op:t,value1:e,value2:n}}},{key:"shuntValue",value:function(t){this.output.push(t)}},{key:"collapseOp",value:function(t){var e=this.output.pop(),n=this.output.pop(),r=this.astConstructor(t,n,e);this.output.push(r)}},{key:"shuntOp",value:function(t){var e=t.content;if(!this.precedences[e])throw new b("".concat(e," is not a valid operator"),t);if(this.operatorStack.length<1)this.operatorStack.push(t);else{var n=this.operatorStack[this.operatorStack.length-1];if(this.precedences[e]<=this.precedences[n.content]){var r=this.operatorStack.pop();this.collapseOp(r)}this.operatorStack.push(t)}}},{key:"getOutput",value:function(){for(;this.operatorStack.length>0;)this.collapseOp(this.operatorStack.pop());if(1!==this.output.length)throw new m("Should only be a single expression in shunter output");return this.output.pop()}}])&&A(e.prototype,n),t}(),_=function(t){return{message:function(){return t},pass:!0}},P=function(t){return{message:function(){return t},pass:!1}},F={toHaveTokenTypes:function(t,e){var n=t.length,r=e.length;if(n!==r)return P("Expected ".concat(r," tokens but found ").concat(n));for(var i=0;i<n;i++){var o=t[i].type,a=e[i];if(o!==a)return P("Expected token type '".concat(a,"' but found '").concat(o,"' at index ").concat(i))}return _("")},toHaveTokenContent:function(t,e){var n=t.length,r=e.length;if(n!==r)return P("Expected ".concat(r," tokens but found ").concat(n));for(var i=0;i<n;i++){var o=t[i].content,a=e[i];if(o!==a)return P("Expected token content '".concat(a,"' but found '").concat(o,"' at index").concat(i))}return _("")},toBeAt:function(t,e,n){var r=t.line,i=t.character;return r!==e?P("Expected line to be ".concat(e," but it was ").concat(r)):(i!==n&&P("Expected character to be ".concat(n,"  but it was ").concat(i)),_(""))}};n.d(e,"Parser",(function(){return y})),n.d(e,"Lexer",(function(){return w})),n.d(e,"StandardTokenTypes",(function(){return S})),n.d(e,"LineTracker",(function(){return k})),n.d(e,"ArithmaticShunter",(function(){return R})),n.d(e,"PatternDefinitionException",(function(){return h})),n.d(e,"LexerException",(function(){return p})),n.d(e,"UnmatchedCharacterException",(function(){return v})),n.d(e,"ParserException",(function(){return m})),n.d(e,"UnexpectedTokenException",(function(){return b})),n.d(e,"expectMatchers",(function(){return F}))}])}).call(this,n(13))},function(t,e){const n=[{savebuffer:{name:"savebuffer",vertexShader:"attribute vec3 position;\nattribute vec2 texcoord;\n\nvarying vec2 Texcoord;\n\nvoid main()\n{\n    Texcoord = texcoord;\n    gl_Position = vec4(position, 1.0);\n}\n",fragmentShader:"precision mediump float;\nvarying highp vec2 Texcoord;\n\nuniform sampler2D Texture;\n\nvoid main()\n{\n    vec4 texel1 = texture2D(Texture, Texcoord);\n    gl_FragColor = texel1;\n}\n"}}];t.exports=n.length<=1?n[0]:n},function(t,e){const n=[{paintover:{name:"paintover",vertexShader:"attribute vec3 position;\nattribute vec2 texcoord;\n\nvarying vec2 Texcoord;\n\nvoid main()\n{\n    Texcoord = texcoord;\n    gl_Position = vec4(position, 1.0);\n}\n",fragmentShader:"precision mediump float;\nvarying highp vec2 Texcoord;\n\nuniform sampler2D newFrame;\nuniform sampler2D lastFrame;\nuniform sampler2D depth;\n\nvarying vec4 outColor;\n\nvoid main() {\n    float z = texture2D(depth, Texcoord).r;\n\n    vec4 texel1 = texture2D(newFrame, Texcoord);\n    vec4 texel2 = texture2D(lastFrame, Texcoord);\n\n    if (z < 1.0) {\n        gl_FragColor = texel1;\n    } else {\n        gl_FragColor = texel2;\n    }\n}\n"}}];t.exports=n.length<=1?n[0]:n},function(t,e){const n=[{defaults:[{name:"bpm",code:"bpm = 120\n"},{name:"nudge",code:"nudge = 0\n"},{name:"pi",code:"pi = 3.14159265\n"}]}];t.exports=n.length<=1?n[0]:n},function(t,e){const n=[{styleFunctions:[{name:"fill",code:"func fill(r, g, b, a, &blk)\n  r := 255\n  g := r\n  b := r\n  a := 255\n  s = :fill\n  if (isNull(blk))\n    style(s, r, g, b, a)\n  else\n    pushSnapshot()\n    style(s, r, g, b, a)\n    blk()\n    popSnapshot()\n"},{name:"noFill",code:"func noFill(&blk)\n  s = :noFill\n  if (isNull(blk))\n    style(s)\n  else\n    pushSnapshot()\n    style(s)\n    blk()\n    popSnapshot()\n"},{name:"stroke",code:"func stroke(r, g, b, a, &blk)\n  r := 255\n  g := r\n  b := r\n  a := 255\n  s = :stroke\n  if (isNull(blk))\n    style(s, r, g, b, a)\n  else\n    pushSnapshot()\n    style(s, r, g, b, a)\n    blk()\n    popSnapshot()\n"},{name:"noStroke",code:"func noStroke(&blk)\n  s = :noStroke\n  if (isNull(blk))\n    style(s)\n  else\n    pushSnapshot()\n    style(s)\n    blk()\n    popSnapshot()\n"},{name:"texture",code:"func texture(name, &blk)\n  m = :material\n  if (isNull(blk))\n    style(m, :texture)\n    style(:texture, name)\n  else\n    pushSnapshot()\n    style(m, :texture)\n    style(:texture, name)\n    blk()\n    popSnapshot()\n"}]}];t.exports=n.length<=1?n[0]:n},function(t,e){const n=[{transformationFunctions:[{name:"rotate",code:"func rotate(x, y, z, &blk)\n  x := ((bpm/60) * ((time/100) + nudge))\n  y := x\n  z := 0\n  m = :rotate\n  if (isNull(blk))\n    matrix(m, x, y, z)\n  else\n    pushSnapshot()\n    matrix(m, x, y, z)\n    blk()\n    popSnapshot()\n"},{name:"scale",code:"func scale(x, y, z, &blk)\n  x := cos((bpm/60)*((time/100) + nudge))\n  y := x\n  z := y\n  m = :scale\n  if (isNull(blk))\n    matrix(m, x, y, z)\n  else\n    pushSnapshot()\n    matrix(m, x, y, z)\n    blk()\n    popSnapshot()\n"},{name:"move",code:"func move(x, y, z, &blk)\n  if (isNull(x))\n    b = (bpm/60) * ((time/100) + nudge)\n    x = cos(b)\n    y = sin(b)\n    z = cos(b)\n  else\n    y := 0\n    z := 0\n  m = :move\n  if (isNull(blk))\n    matrix(m, x, y, z)\n  else\n    pushSnapshot()\n    matrix(m, x, y, z)\n    blk()\n    popSnapshot()\n"}]}];t.exports=n.length<=1?n[0]:n},function(t,e){const n=[{shapeFunctions:[{name:"triangle",code:"func triangle(x, y)\n  x := 1\n  y := x\n  shape(:triangle, x, y, 1)\n"},{name:"cube",code:"func cube(x, y, z)\n  x := 1\n  y := x\n  z := y\n  shape(:cube, x, y, z)\n"},{name:"sphere",code:"func sphere(x, y, z)\n  x := 1\n  y := x\n  z := y\n  shape(:sphere, x, y, z)\n"},{name:"cylinder",code:"func cylinder(x, y, z)\n  x := 1\n  y := x\n  z := y\n  shape(:cylinder, x, y, z)\n"},{name:"rectangle",code:"func rectangle(x, y)\n  x := 1\n  y := x\n  shape(:rectangle, x, y, 1)\n"},{name:"line",code:"func line(x)\n  x := 1\n  shape(:line, x, 1, 1)\n"}]}];t.exports=n.length<=1?n[0]:n},function(t,e){const n=[{material:{name:"basic",attributes:["position","barycentric"],uniforms:["Pmatrix","Vmatrix","Mmatrix","Color","WireColor","StrokeSize"],vertexShader:"attribute vec3 position;\nattribute vec3 barycentric;\n\nuniform mat4 Pmatrix;\nuniform mat4 Vmatrix;\nuniform mat4 Mmatrix;\nuniform vec4 Color;\nuniform vec4 WireColor;\nuniform float StrokeSize;\n\nvarying vec4 vColor;\nvarying vec4 vWireColor;\nvarying vec3 vbc;\nvarying float vStrokeSize;\n\nvoid main(void) {\n  gl_Position = ((Pmatrix * Vmatrix) * Mmatrix) * vec4(position, 1.);\n  vColor = Color;\n  vWireColor = WireColor;\n  vbc = barycentric;\n  vStrokeSize = StrokeSize;\n}\n",fragmentShader:"precision mediump float;\n\nvarying vec4 vColor;\nvarying vec4 vWireColor;\nvarying vec3 vbc;\nvarying float vStrokeSize;\n\nvoid main(void) {\n  if(vbc.x < vStrokeSize || vbc.y < vStrokeSize || vbc.z < vStrokeSize) {\n    gl_FragColor = vWireColor;\n  } else {\n    gl_FragColor = vColor;\n  }\n}\n"}}];t.exports=n.length<=1?n[0]:n},function(t,e){const n=[{material:{name:"weird",attributes:["position","barycentric"],uniforms:["Pmatrix","Vmatrix","Mmatrix"],vertexShader:"attribute vec3 position;\nattribute vec3 barycentric;\n\nuniform mat4 Pmatrix;\nuniform mat4 Vmatrix;\nuniform mat4 Mmatrix;\n\nvarying vec3 vbc;\n\nvoid main(void) {\n  gl_Position = ((Pmatrix * Vmatrix) * Mmatrix) * vec4(position, 1.);\n  vbc = barycentric;\n}\n",fragmentShader:"precision mediump float;\n\nvarying vec3 vbc;\n\nvoid main(void) {\n  gl_FragColor = vec4(vbc, 1.0);\n}\n"}}];t.exports=n.length<=1?n[0]:n},function(t,e){const n=[{material:{name:"texture",attributes:["position","textureCoord"],uniforms:["Pmatrix","Vmatrix","Mmatrix","Texture"],vertexShader:"attribute vec3 position;\nattribute vec2 textureCoord;\n\nuniform mat4 Pmatrix;\nuniform mat4 Vmatrix;\nuniform mat4 Mmatrix;\n\nvarying highp vec2 vTextureCoord;\n\nvoid main(void) {\n  gl_Position = ((Pmatrix * Vmatrix) * Mmatrix) * vec4(position, 1.);\n  vTextureCoord = textureCoord;\n}\n",fragmentShader:"precision mediump float;\n\nvarying highp vec2 vTextureCoord;\nuniform sampler2D Texture;\n\nvoid main(void) {\n  gl_FragColor = texture2D(Texture, vTextureCoord);\n}\n"}}];t.exports=n.length<=1?n[0]:n},function(t,e){const n=[{material:{name:"bordered",attributes:["position","barycentric"],uniforms:["Pmatrix","Vmatrix","Mmatrix","WireColor","StrokeSize"],vertexShader:"attribute vec3 position;\nattribute vec3 barycentric;\n\nuniform mat4 Pmatrix;\nuniform mat4 Vmatrix;\nuniform mat4 Mmatrix;\nuniform vec4 WireColor;\nuniform float StrokeSize;\n\nvarying vec4 vWireColor;\nvarying vec3 vbc;\nvarying float vStrokeSize;\n\nvoid main(void) {\n  gl_Position = ((Pmatrix * Vmatrix) * Mmatrix) * vec4(position, 1.);\n  vWireColor = WireColor;\n  vbc = barycentric;\n  vStrokeSize = StrokeSize;\n}\n",fragmentShader:"precision mediump float;\n\nvarying vec4 vWireColor;\nvarying vec3 vbc;\nvarying float vStrokeSize;\n\nvoid main(void) {\n  if(vbc.x < vStrokeSize || vbc.y < vStrokeSize || vbc.z < vStrokeSize) {\n    gl_FragColor = vWireColor;\n  } else {\n    discard;\n  }\n}\n"}}];t.exports=n.length<=1?n[0]:n},function(t,e){const n=[{material:{name:"normalised",attributes:["position","normals"],uniforms:["Pmatrix","Vmatrix","Mmatrix"],vertexShader:"attribute vec3 position;\nattribute vec3 normals;\n\nuniform mat4 Pmatrix;\nuniform mat4 Vmatrix;\nuniform mat4 Mmatrix;\n\nvarying vec3 vNormal;\n\nvoid main(void) {\n  mat4 mvp = (Pmatrix * Vmatrix) * Mmatrix;\n  gl_Position = mvp * vec4(position, 1.);\n  vNormal = (mvp * vec4(normals, 1)).xyz;\n}\n",fragmentShader:"precision mediump float;\n\nvarying vec3 vNormal;\n\nvoid main(void) {\n  gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, 1.0 );\n}\n"}}];t.exports=n.length<=1?n[0]:n},function(t,e){const n=[{material:{name:"ceed",attributes:["position","barycentric","normals"],uniforms:["Pmatrix","Vmatrix","Mmatrix","StrokeSize"],vertexShader:"attribute vec3 position;\nattribute vec3 barycentric;\nattribute vec3 normals;\n\nuniform mat4 Pmatrix;\nuniform mat4 Vmatrix;\nuniform mat4 Mmatrix;\nuniform float StrokeSize;\n\nvarying vec3 vbc;\nvarying float vStrokeSize;\nvarying vec3 vNormal;\n\nvoid main(void) {\n  mat4 mvp = (Pmatrix * Vmatrix) * Mmatrix;\n  gl_Position = mvp * vec4(position, 1.);\n  vbc = barycentric;\n  vStrokeSize = StrokeSize;\n  vNormal = (mvp * vec4(normals, 1)).xyz;\n}\n",fragmentShader:"precision mediump float;\n\nvarying vec3 vNormal;\nvarying vec3 vbc;\nvarying float vStrokeSize;\n\nvoid main(void) {\n  if(vbc.x < vStrokeSize || vbc.y < vStrokeSize || vbc.z < vStrokeSize) {\n    gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, 1.0 );\n  } else {\n    discard;\n  }\n}\n"}}];t.exports=n.length<=1?n[0]:n},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";n.r(e),n.d(e,"createImproviz",(function(){return gn}));var r=n(0),i=r.StandardTokenTypes.whitespace(),o={name:"comment",ignore:!0,regexp:/^\/\/[^\n]*/},a={name:"newline",regexp:/^\n+/},u=r.StandardTokenTypes.constant(",","comma"),c=r.StandardTokenTypes.constant(":","colon"),s=r.StandardTokenTypes.constant("=>","lambda arrow"),f=r.StandardTokenTypes.constant("=","assignment"),l=r.StandardTokenTypes.constant("&","&"),h=r.StandardTokenTypes.constant("(","open paren"),p=r.StandardTokenTypes.constant(")","close paren"),v=r.StandardTokenTypes.constant("[","open bracket"),m=r.StandardTokenTypes.constant("]","close bracket"),b=r.StandardTokenTypes.constant("|","pipe"),d=["if","elif","else","null","loop","times","with","func"],y={name:"operator",regexp:/^(==|>=|<=|<|>|&&|\|\||\+|-|\*|\/|%)/},g={name:"number",regexp:/^\d+(\.\d+)?/,interpret:function(t){return parseFloat(t)}},k={name:"identifier",regexp:/^[a-zA-Z][a-zA-Z0-9]*/};function x(){var t=new r.Lexer({languageName:"improviz"});return t.addTokenType(i),t.addTokenType(a),t.addTokenType(o),t.addTokenType(y),t.addTokenType(u),t.addTokenType(c),t.addTokenType(b),t.addTokenType(s),t.addTokenType(f),t.addTokenType(l),t.addTokenType(h),t.addTokenType(p),t.addTokenType(v),t.addTokenType(m),t.addTokenType(g),d.forEach((function(e){t.addTokenType(r.StandardTokenTypes.constant(e,e))})),t.addTokenType(k),t}function w(t){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function E(t,e){return(E=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function S(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=A(t);if(e){var i=A(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return T(this,n)}}function T(t,e){return!e||"object"!==w(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function A(t){return(A=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var R=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&E(t,e)}(n,t);var e=S(n);function n(t,r,i){var o;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n);var a="Expected ".concat(t," levels of indentation but found ").concat(r);return(o=e.call(this,a)).name="IncorrectIndentationException",o.displayable=!0,o.line=i.line,o.character=i.character,o.length=i.content.length,o}return n}(r.ParserException),_="NUM";function P(t){return{type:"PROGRAM",statements:t}}function F(t){return{type:"BLOCK",elements:t}}function O(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.line,r=e.character;return{type:"IF",conditionals:t,line:n,character:r}}function N(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=r.line,o=r.character;return{type:"LAMBDA",args:t,scope:e,body:n,line:i,character:o}}function C(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:B(),r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=r.line,o=r.character;return{type:"FUNC",name:t,args:e,body:n,line:i,character:o}}function L(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:B(),r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=r.line,o=r.character;return{type:"APPLICATION",name:t,args:e,lambda:n,line:i,character:o}}function U(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.line,r=e.character;return{type:"VARIABLE",identifier:t,line:n,character:r}}function M(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.line,i=n.character;return{type:"INDEX",collection:t,index:e,line:r,character:i}}function D(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.line,r=e.character;return{type:_,value:t,line:n,character:r}}function B(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.line,n=t.character;return{type:"NULL",line:e,character:n}}function I(t){return(I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function j(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function z(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function W(t,e){return(W=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function G(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=V(t);if(e){var i=V(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return X(this,n)}}function X(t,e){return!e||"object"!==I(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function V(t){return(V=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Y={"^":15,"*":14,"/":14,"%":14,"+":13,"-":13,"<":11,"<=":11,">":11,">=":11,"==":10,"!=":10,"&&":6,"||":5},H=function(t,e,n){return function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=r.line,o=r.character;return{type:"BINARYOP",operator:t,left:e,right:n,line:i,character:o}}(t.content,e,n,void 0,{})},q=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&W(t,e)}(a,t);var e,n,i,o=G(a);function a(){return j(this,a),o.apply(this,arguments)}return e=a,(n=[{key:"clearNewlines",value:function(){for(;!this.eof()&&this.la1("newline");)this.match("newline")}},{key:"calculateBlockLevel",value:function(t){return Math.round((t.character-1)/2)}},{key:"blockDepthCheck",value:function(t,e){var n=this.calculateBlockLevel(e);return t!==n&&this.errors.push(new R(t,n,e)),n}},{key:"skipUntil",value:function(t){for(;!this.eof();){var e=this.peek();if(t.includes(e.type))break;this.next()}}},{key:"parse",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.debugLog("With Debugging"),this.errors=[];var r=x(),i=r.tokenize(t);i.errors.forEach((function(t){return e.errors.push(t)})),this.initialize(i.tokens,n);var o=this.program();return{ast:o,errors:this.errors}}},{key:"program",value:function(){this.debugLog("Program");var t=[];for(this.clearNewlines();!this.eof();)t.push(this.statement(0));return P(t)}},{key:"statement",value:function(t){if(this.debugLog("Statement"),this.la1("if"))return this.if(t);if(this.la1("func"))return this.funcDef(t);if(this.la1("loop"))return this.loop(t);if(this.la1("identifier")){var e=this.match("identifier");if(this.blockDepthCheck(t,e),this.la1("assignment")||this.la1("colon"))return this.assignment(e);if(this.la1("open paren"))return this.application(t,e)}var n=this.peek();this.errors.push(new r.UnexpectedTokenException(n.type,n)),this.skipUntil(["newline"]),this.clearNewlines()}},{key:"block",value:function(t){this.debugLog("Block");for(var e=t,n=[];!this.eof();){var r=this.peek();if(this.calculateBlockLevel(r)<e)break;n.push(this.element(t))}return F(n)}},{key:"element",value:function(t){if(this.debugLog("Element"),this.la1("if"))return this.if(t);if(this.la1("func"))return this.funcDef(t);if(this.la1("loop"))return this.loop(t);if(this.la1("identifier")){var e=this.match("identifier");if(this.blockDepthCheck(t,e),this.la1("assignment")||this.la1("colon"))return this.assignment(e);if(this.la1("open paren"))return this.application(t,e)}var n=this.peek();this.errors.push(new r.UnexpectedTokenException(n.type,n)),this.skipUntil(["newline"]),this.clearNewlines()}},{key:"if",value:function(t){this.debugLog("If");var e,n=this.position(),r=[],i=this.match("if");this.blockDepthCheck(t,i);try{e=this.expression()}catch(t){this.errors.push(t),this.resetStream("newline"),e=B()}this.clearNewlines();var o=this.block(t+1);if(r.push([e,o]),this.eof()||!this.la1("else"))return O(r,n);for(;!this.eof()&&this.la1("else");){var a=this.match("else");this.blockDepthCheck(t,a);var u=void 0;if(this.la1("if")){this.match("if");try{u=this.expression()}catch(t){this.errors.push(t),this.resetStream("newline"),u=B()}}else u=D(1);this.clearNewlines();var c=this.block(t+1);r.push([u,c])}return O(r,n)}},{key:"funcDef",value:function(t){this.debugLog("Function Definition");var e,n,r,i=this.position(),o=this.match("func");this.blockDepthCheck(t,o);try{if(e=this.match("identifier").content,this.match("open paren"),n=this.argList("close paren","comma"),this.match("close paren"),this.la1("lambda arrow"))return this.match("lambda arrow"),r=this.expression(),this.clearNewlines(),C(e,n,F([r]),i)}catch(t){this.errors.push(t),this.resetStream("newline")}return this.clearNewlines(),C(e,n,this.block(t+1),i)}},{key:"argList",value:function(t,e){var n=[];if(this.la1(t))return this.debugLog("argList: 0 args"),n;for(n.push(this.functionArg());this.la1(e);)this.match(e),n.push(this.functionArg());return this.debugLog("argList: ".concat(n.length," args")),n}},{key:"functionArg",value:function(){return this.debugLog("Function Argument"),this.la1("&")?(this.match("&"),function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.line,r=e.character;return{type:"BLOCKARG",name:t,line:n,character:r}}(this.match("identifier").content)):function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.line,r=e.character;return{type:"VARARG",name:t,line:n,character:r}}(this.match("identifier").content)}},{key:"loop",value:function(t){this.debugLog("Loop");var e,n,r=this.position(),i=this.match("loop");this.blockDepthCheck(t,i);try{e=this.expression(),this.match("times"),n=B(),this.la1("with")&&(this.match("with"),n=this.variable())}catch(t){this.errors.push(t),this.resetStream("newline")}return this.clearNewlines(),function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:B(),r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=r.line,o=r.character;return{type:"LOOP",count:t,block:e,loopVar:n,line:i,character:o}}(e,this.block(t+1),n,r)}},{key:"assignment",value:function(t){this.debugLog("Assignment");var e,n=this.tokenPosition(t);if(this.la1("colon")){try{this.match("colon"),this.match("assignment"),e=this.expression()}catch(t){this.errors.push(t),this.resetStream("newline")}return this.clearNewlines(),function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.line,i=n.character;return{type:"CONDASSIGNMENT",identifier:t,expression:e,line:r,character:i}}(t.content,e,n)}try{this.match("assignment"),e=this.expression()}catch(t){this.errors.push(t),this.resetStream("newline")}return this.clearNewlines(),function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.line,i=n.character;return{type:"ASSIGNMENT",identifier:t,expression:e,line:r,character:i}}(t.content,e,n)}},{key:"application",value:function(t,e){this.debugLog("Application");var n,r=this.tokenPosition(e);try{this.match("open paren"),n=this.exprList(),this.match("close paren")}catch(t){this.errors.push(t),this.resetStream("newline")}if(this.eof()||!this.la1("newline"))return L(e.content,n,B(),r);if(this.clearNewlines(),this.eof())return L(e.content,n,B(),r);if(this.calculateBlockLevel(this.peek())<=t)return L(e.content,n,B(),r);var i=this.applicationLambda(t+1);return L(e.content,n,i,r)}},{key:"applicationLambda",value:function(t){var e=this.position(),n=[];if(this.la1("pipe")){var r=this.match("pipe");this.blockDepthCheck(t,r);try{n=this.argList("pipe","comma"),this.match("pipe"),this.match("newline")}catch(t){this.errors.push(t),this.resetStream("newline")}}var i=this.block(t);return N(n,B(),i,e)}},{key:"expressionApplication",value:function(t){var e,n=this.position();try{this.match("open paren"),e=this.exprList(),this.match("close paren")}catch(t){this.errors.push(t),this.resetStream("newline")}return L(t.content,e,B(),n)}},{key:"exprList",value:function(){var t=[];if(this.la1("close paren"))return this.debugLog("exprList: 0 args"),t;for(t.push(this.expression());this.la1("comma");){this.match("comma");var e=void 0;try{e=this.expression()}catch(t){this.errors.push(t),this.resetStream("comma")}t.push(e)}return this.debugLog("exprList: ".concat(t.length," args")),t}},{key:"expression",value:function(){this.debugLog("Expression");var t=this.baseExpression();return!this.eof()&&this.la1("operator")?this.operator(t):t}},{key:"operator",value:function(t){this.debugLog("Operator");var e=new r.ArithmaticShunter(Y,{astConstructor:H});for(e.shuntValue(t);!this.eof()&&this.la1("operator");)e.shuntOp(this.match("operator")),e.shuntValue(this.baseExpression());return e.getOutput()}},{key:"baseExpression",value:function(){var t;if(this.debugLog("Base Expression"),this.la1("number"))t=this.number();else if(this.la1("open paren"))this.match("open paren"),t=this.expression(),this.match("close paren");else if(this.la1("operator")){var e=this.match("operator"),n=this.baseExpression();t=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.line,i=n.character;return{type:"UNARYOP",operator:t,expr:e,line:r,character:i}}(e.content,n)}else if(this.la1("colon"))this.match("colon"),t=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.line,r=e.character;return{type:"SYMBOL",value:t,line:n,character:r}}(this.match("identifier").content);else if(this.la1("null"))this.match("null"),t=B();else if(this.la1("open bracket")){this.match("open bracket");var r=this.exprList();this.match("close bracket"),t=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.line,r=e.character;return{type:"LIST",values:t,line:n,character:r}}(r)}else if(this.la1("identifier")){var i=this.match("identifier");t=!this.eof()&&this.la1("open paren")?this.expressionApplication(i):U(i.content)}for(;!this.eof()&&this.la1("open bracket");){this.match("open bracket");var o=this.expression();this.match("close bracket"),t=M(t,o)}return t}},{key:"number",value:function(){this.debugLog("Number");var t=this.position();return D(this.match("number").content,t)}},{key:"variable",value:function(){this.debugLog("Variable");var t=this.position();return U(this.match("identifier").content,t)}}])&&z(e.prototype,n),i&&z(e,i),a}(r.Parser);function $(t){return($="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function K(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Z(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&rt(t,e)}function J(t){var e=nt();return function(){var n,r=it(t);if(e){var i=it(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Q(this,n)}}function Q(t,e){return!e||"object"!==$(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function tt(t){var e="function"==typeof Map?new Map:void 0;return(tt=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return et(t,arguments,it(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),rt(r,t)})(t)}function et(t,e,n){return(et=nt()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&rt(i,n.prototype),i}).apply(null,arguments)}function nt(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function rt(t,e){return(rt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function it(t){return(it=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ot=function(t){Z(n,t);var e=J(n);function n(t){var r;return K(this,n),(r=e.call(this,t)).name="InvalidProgramError",r}return n}(tt(Error)),at=function(t){Z(n,t);var e=J(n);function n(t,r){var i;return K(this,n),(i=e.call(this,t)).name="InterpreterError",i.line=r.line,i.character=r.character,i}return n}(tt(Error));function ut(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],r=!0,i=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==u.return||u.return()}finally{if(i)throw o}}return n}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return ct(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ct(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ct(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function st(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ft(t){return Object.create(t)}var lt=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n,r;return e=t,(n=[{key:"run",value:function(t,e,n){var r,i={errors:[],exitCode:0};if(!t||"PROGRAM"!==t.type)return i.errors.push(new ot("Invalid Program")),i.exitCode=1,i;r=n?e:ft(e);try{this.evaluateProgram(t,r)}catch(t){i.errors.push(t),i.exitCode=1}return i}},{key:"evaluateProgram",value:function(t,e){for(var n=0;n<t.statements.length;n+=1){var r=t.statements[n];this.evaluate(r,e)}}},{key:"evaluate",value:function(t,e){var n,r=this;switch(t.type){case"BLOCK":n=this.evaluateBlock(t,e);break;case"LOOP":n=this.evaluateLoop(t,e);break;case"ASSIGNMENT":case"CONDASSIGNMENT":n=this.evaluateAssignment(t,e);break;case"IF":n=this.evaluateIf(t,e);break;case"LAMBDA":n=this.evaluateLambda(t,e);break;case"FUNC":n=this.evaluateFunctionDefinition(t,e);break;case"APPLICATION":n=this.evaluateApplication(t,e);break;case"BINARYOP":n=this.evaluateBinaryOp(t,e);break;case"UNARYOP":n=this.evaluateUnaryOp(t,e);break;case"VARIABLE":n=this.evaluateVariable(t,e);break;case"INDEX":n=this.evaluateDeIndex(t,e);break;case _:case"SYMBOL":n=t;break;case"LIST":n=t.values.map((function(t){return r.evaluate(t,e)}));break;default:throw new at("Unknown AST Type: ".concat(t.type),t)}return n}},{key:"evaluateBlock",value:function(t,e){for(var n=ft(e),r=B(),i=0;i<t.elements.length;i+=1){var o=t.elements[i];r=this.evaluate(o,n)}return r}},{key:"evaluateAssignment",value:function(t,e){var n=this.evaluate(t.expression,e);return"ASSIGNMENT"===t.type?e[t.identifier]=n:"CONDASSIGNMENT"!==t.type||void 0!==e[t.identifier]&&"NULL"!==e[t.identifier].type||(e[t.identifier]=n),n}},{key:"isNull",value:function(t){return null==t||"NULL"===t.type}},{key:"notNull",value:function(t){return null!=t&&"NULL"!==t.type}},{key:"truthyValue",value:function(t){return!this.isNull(t)&&(t.type!==_||0!==t.value)}},{key:"checkNum",value:function(t){if(!t||t.type!==_)throw new at("Expected Number but found: ".concat(t.type),t)}},{key:"evaluateIf",value:function(t,e){for(var n=t.conditionals,r=0;r<n.length;r+=1){var i=ut(n[r],2),o=i[0],a=i[1];this.truthyValue(this.evaluate(o,e))&&this.evaluateBlock(a,e)}}},{key:"evaluateApplication",value:function(t,e){var n=this,r=t.name,i=t.args,o=t.lambda,a=e[r];if(!a||"LAMBDA"===a.type&&"BUILTIN"===a.type)throw new at("".concat(r," is not a function"),t);var u=i.map((function(t){return n.evaluate(t,e)}));if("LAMBDA"===a.type){for(var c=this.notNull(a.scope)?a.scope:ft(e),s=0;s<a.args.length;s+=1){var f=a.args[s];switch(f.type){case"VARARG":c[f.name]=u[s]||B();break;case"BLOCKARG":if(this.isNull(o)){c[f.name]=B();break}this.isNull(o.scope)&&(o.scope=e),c[f.name]=o;break;default:throw new at("Unknown variable type ".concat(f.type),f)}}return this.evaluateBlock(a.body,c)}if("BUILTIN"===a.type)return a.func(u,o)}},{key:"blockToLambda",value:function(t,e){return N([],e,t)}},{key:"evaluateLambda",value:function(t){throw new at("Shouldn't be evaluating a lambda",t)}},{key:"evaluateFunctionDefinition",value:function(t,e){var n=t.name,r=N(t.args,e,t.body);e[n]=r}},{key:"evaluateLoop",value:function(t,e){var n=t.count,r=t.block,i=t.loopVar,o=this.evaluate(n,e);if(o.type!==_)throw new at("Loop count should be a number",n);for(var a=o.value,u=ft(e),c=0;c<a;c+=1)this.notNull(i)&&(u[i.identifier]=D(c)),this.evaluate(r,u)}},{key:"evaluateUnaryOp",value:function(t,e){var n,r=this.evaluate(t.expr,e);this.checkNum(r);var i=r.value;switch(t.operator){case"-":n=-1*i;break;default:throw new at("".concat(t.operator," is an unknown operator"),t)}return D(n)}},{key:"evaluateBinaryOp",value:function(t,e){var n,r=this.evaluate(t.left,e);this.checkNum(r);var i=this.evaluate(t.right,e);this.checkNum(i);var o=r.value,a=i.value;switch(t.operator){case"+":n=o+a;break;case"-":n=o-a;break;case"*":n=o*a;break;case"/":n=o/a;break;case"^":n=Math.pow(o,a);break;case"%":n=o%a;break;case">":n=o>a?1:0;break;case"<":n=o<a?1:0;break;case">=":n=o>=a?1:0;break;case"<=":n=o<=a?1:0;break;case"==":n=o===a?1:0;break;case"&&":n=o&&a?1:0;break;case"||":n=o||a?1:0;break;default:throw new at("".concat(t.operator," is an unknown operator"),t)}return D(n)}},{key:"evaluateVariable",value:function(t,e){var n=e[t.identifier];if(void 0===n)throw new at("Undefined Variable: ".concat(t.identifier),t);return n}},{key:"evaluateDeIndex",value:function(t,e){var n=this.evaluate(t.collection,e);if(!Array.isArray(n))throw new at("Can only deindex a list",t);var r=this.evaluate(t.index,e);return this.checkNum(r),n[r.value]}}])&&st(e.prototype,n),r&&st(e,r),t}();function ht(t){return t&&t.type===_}function pt(t){return t&&"SYMBOL"===t.type}function vt(t,e){return function(t,e){return{type:"BUILTIN",name:t,func:e}}(t,e)}function mt(t){return D(t)}function bt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],r=!0,i=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==u.return||u.return()}finally{if(i)throw o}}return n}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return dt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return dt(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function dt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function yt(t){var e=t.shift();if(!pt(e))throw new at("Expected Symbol but found ".concat(e.type),e);switch(e.value){case"fill":gt.call(this,t);break;case"noFill":this.fillStack.push({style:"nofill"});break;case"stroke":kt.call(this,t);break;case"noStroke":this.strokeStack.push({style:"nostroke"});break;case"strokeSize":xt.call(this,t);break;case"material":wt.call(this,t);break;case"texture":Et.call(this,t);break;default:throw new at("Unknown style command",e)}}function gt(t){var e=bt(t,4),n=e[0],r=e[1],i=e[2],o=e[3];if(!ht(n))throw new at("Expected Number",n);if(!ht(r))throw new at("Expected Number",r);if(!ht(i))throw new at("Expected Number",i);if(!ht(o))throw new at("Expected Number",o);this.fillStack.push({style:"fill",color:[n.value,r.value,i.value,o.value]})}function kt(t){var e=bt(t,4),n=e[0],r=e[1],i=e[2],o=e[3];if(!ht(n))throw new at("Expected Number",n);if(!ht(r))throw new at("Expected Number",r);if(!ht(i))throw new at("Expected Number",i);if(!ht(o))throw new at("Expected Number",o);this.strokeStack.push({style:"stroke",color:[n.value,r.value,i.value,o.value]})}function xt(t){var e=bt(t,1)[0];if(!ht(e))throw new at("Expected Number",e);this.strokeSizeStack.push(e.value)}function wt(t){var e=bt(t,1)[0];if(!pt(e))throw new at("Expected Symbol",e);this.materialStack.push(e.value)}function Et(t){var e=bt(t,1)[0];if(!pt(e))throw new at("Expected Symbol",e);this.textureStack.push(e.value)}var St=Math.sin,Tt=Math.cos,At=Math.tan,Rt=Math.sqrt,_t=Math.PI/180,Pt=function(t,e,n){return[t,e,n]};function Ft(t,e){return t.map((function(t,n){return t-e[n]}))}function Ot(t){var e=function(t){return Rt(t.reduce((function(t,e){return t+e*e}),0))}(t);return t.map((function(t){return t/e}))}function Nt(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function Ct(t,e){return t.reduce((function(t,n,r){return t+n*e[r]}),0)}function Lt(t,e){return[t[0]*e[0]+t[1]*e[4]+t[2]*e[8]+t[3]*e[12],t[0]*e[1]+t[1]*e[5]+t[2]*e[9]+t[3]*e[13],t[0]*e[2]+t[1]*e[6]+t[2]*e[10]+t[3]*e[14],t[0]*e[3]+t[1]*e[7]+t[2]*e[11]+t[3]*e[15],t[4]*e[0]+t[5]*e[4]+t[6]*e[8]+t[7]*e[12],t[4]*e[1]+t[5]*e[5]+t[6]*e[9]+t[7]*e[13],t[4]*e[2]+t[5]*e[6]+t[6]*e[10]+t[7]*e[14],t[4]*e[3]+t[5]*e[7]+t[6]*e[11]+t[7]*e[15],t[8]*e[0]+t[9]*e[4]+t[10]*e[8]+t[11]*e[12],t[8]*e[1]+t[9]*e[5]+t[10]*e[9]+t[11]*e[13],t[8]*e[2]+t[9]*e[6]+t[10]*e[10]+t[11]*e[14],t[8]*e[3]+t[9]*e[7]+t[10]*e[11]+t[11]*e[15],t[12]*e[0]+t[13]*e[4]+t[14]*e[8]+t[15]*e[12],t[12]*e[1]+t[13]*e[5]+t[14]*e[9]+t[15]*e[13],t[12]*e[2]+t[13]*e[6]+t[14]*e[10]+t[15]*e[14],t[12]*e[3]+t[13]*e[7]+t[14]*e[11]+t[15]*e[15]]}function Ut(t,e,n){return[t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1]}function Mt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],r=!0,i=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==u.return||u.return()}finally{if(i)throw o}}return n}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return Dt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Dt(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Dt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Bt(t){var e=Mt(t,4),n=e[0],r=e[1],i=e[2],o=e[3];if(!pt(n))throw new at("Expected Symbol",n);if(!ht(r))throw new at("Expected Number",r);if(!ht(i))throw new at("Expected Number",i);if(!ht(o))throw new at("Expected Number",o);this.matrixStack.pushMod(Ut(r.value,i.value,o.value),Lt),this.drawShape(n.value),this.matrixStack.pop()}function It(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],r=!0,i=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==u.return||u.return()}finally{if(i)throw o}}return n}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return jt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return jt(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function jt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function zt(t){var e=t.shift();if(!pt(e))throw new at("Expected Symbol but found ".concat(e.type),e);switch(e.value){case"rotate":Wt.call(this,t);break;case"move":Gt.call(this,t);break;case"scale":Xt.call(this,t);break;default:throw new at("Unknown style command",e)}}function Wt(t){var e,n,r,i,o,a,u,c,s,f,l,h,p=It(t,3),v=p[0],m=p[1],b=p[2];if(!ht(v))throw new at("Expected Number",v);if(!ht(m))throw new at("Expected Number",m);if(!ht(b))throw new at("Expected Number",b);this.matrixStack.pushMod((e=v.value,n=m.value,r=b.value,o=n*_t,a=r*_t,u=St(i=e*_t),c=Tt(i),s=St(o),f=Tt(o),l=St(a),h=Tt(a),[f*h,f*-l,s,0,u*s*h+c*l,c*h-u*s*l,-u*f,0,u*l-c*s*h,c*s*l+u*h,c*f,0,0,0,0,1]),Lt)}function Gt(t){var e,n,r,i=It(t,3),o=i[0],a=i[1],u=i[2];if(!ht(o))throw new at("Expected Number",o);if(!ht(a))throw new at("Expected Number",a);if(!ht(u))throw new at("Expected Number",u);this.matrixStack.pushMod((e=o.value,n=a.value,r=u.value,[1,0,0,e,0,1,0,n,0,0,1,r,0,0,0,1]),Lt)}function Xt(t){var e=It(t,3),n=e[0],r=e[1],i=e[2];if(!ht(n))throw new at("Expected Number",n);if(!ht(r))throw new at("Expected Number",r);if(!ht(i))throw new at("Expected Number",i);this.matrixStack.pushMod(Ut(n.value,r.value,i.value),Lt)}function Vt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],r=!0,i=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==u.return||u.return()}finally{if(i)throw o}}return n}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return Yt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Yt(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Yt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Ht=Math.PI/180;function qt(t){var e=t[0];if(!ht(e))throw new at("Expected Number but found ".concat(e.type),e);return mt(Math.sin(e.value*Ht))}function $t(t){var e=t[0];if(!ht(e))throw new at("Expected Number but found ".concat(e.type),e);return mt(Math.cos(e.value*Ht))}function Kt(t){var e=t[0];if(!ht(e))throw new at("Expected Number but found ".concat(e.type),e);return mt(Math.tan(e.value*Ht))}function Zt(t){var e=t[0];if(!ht(e))throw new at("Expected Number but found ".concat(e.type),e);return mt(Math.abs(e.value))}function Jt(t){var e=t[0];if(!ht(e))throw new at("Expected Number but found ".concat(e.type),e);return mt(Math.ceil(e.value))}function Qt(t){var e=t[0];if(!ht(e))throw new at("Expected Number but found ".concat(e.type),e);return mt(Math.floor(e.value))}function te(t){var e=t[0];if(!ht(e))throw new at("Expected Number but found ".concat(e.type),e);return mt(Math.round(e.value))}function ee(t){var e=t[0];if(!ht(e))throw new at("Expected Number but found ".concat(e.type),e);return mt(Math.log(e.value))}function ne(t){var e=t[0];if(!ht(e))throw new at("Expected Number but found ".concat(e.type),e);return mt(Math.sqrt(e.value))}function re(t){var e=Vt(t,2),n=e[0],r=e[1];if(!ht(n))throw new at("Expected Number but found ".concat(n.type),n);if(!ht(r))throw new at("Expected Number but found ".concat(r.type),r);return n.value>r.value?n:r}function ie(t){var e=Vt(t,2),n=e[0],r=e[1];if(!ht(n))throw new at("Expected Number but found ".concat(n.type),n);if(!ht(r))throw new at("Expected Number but found ".concat(r.type),r);return n.value<r.value?n:r}function oe(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],r=!0,i=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==u.return||u.return()}finally{if(i)throw o}}return n}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return ae(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ae(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ae(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function ue(){this.pushSnapshot()}function ce(){this.popSnapshot()}function se(t){var e=oe(t,3),n=e[0],r=e[1],i=e[2];if(!ht(n))throw new at("Expected Number",n);if(!ht(r))throw new at("Expected Number",r);if(!ht(i))throw new at("Expected Number",i);this.background.set([n.value,r.value,i.value])}function fe(){this.depthCheck.set(!1)}function le(t){var e=oe(t,1)[0];if(!pt(e))throw new at("Expected Symbol",e);this.renderMode.set(e.value)}function he(t){return mt((e=t[0])&&"NULL"===e.type?1:0);var e}var pe=n(3),ve=n(4),me=n(5),be=n(6);function de(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var ye=function(){function t(e,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.runtime=e,this.interpreter=r,this.parser=n,this.scope=this.createScope()}var e,n,r;return e=t,(n=[{key:"createScope",value:function(){var t={shape:vt("shape",Bt.bind(this.runtime)),matrix:vt("matrix",zt.bind(this.runtime)),style:vt("style",yt.bind(this.runtime)),strokeSize:vt("strokeSize",xt.bind(this.runtime)),pushSnapshot:vt("pushSnapshot",ue.bind(this.runtime)),popSnapshot:vt("popSnapshot",ce.bind(this.runtime)),background:vt("background",se.bind(this.runtime)),depthOff:vt("depthOff",fe.bind(this.runtime)),isNull:vt("isNull",he.bind(this.runtime)),sin:vt("sin",qt.bind(this.runtime)),cos:vt("cos",$t.bind(this.runtime)),tan:vt("tan",Kt.bind(this.runtime)),abs:vt("abs",Zt.bind(this.runtime)),ceil:vt("ceil",Jt.bind(this.runtime)),floor:vt("floor",Qt.bind(this.runtime)),round:vt("round",te.bind(this.runtime)),max:vt("max",re.bind(this.runtime)),min:vt("min",ie.bind(this.runtime)),log:vt("log",ee.bind(this.runtime)),sqrt:vt("sqrt",ne.bind(this.runtime)),animationStyle:vt("animationStyle",le.bind(this.runtime))};return this.loadExternals(pe.defaults,t),this.loadExternals(ve.styleFunctions,t),this.loadExternals(me.transformationFunctions,t),this.loadExternals(be.shapeFunctions,t),t}},{key:"loadExternals",value:function(t,e){var n=this;return t.forEach((function(t){var r=n.parser.parse(t.code);if(r.errors.length>0)throw r.errors;var i=n.interpreter.run(r.ast,e,!0);if(0!==i.exitCode)throw i.errors})),e}},{key:"setTime",value:function(t){this.scope.time=mt(t)}}])&&de(e.prototype,n),r&&de(e,r),t}();function ge(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var ke=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.eventBus=n,this.gfx=e,this.parser=new q,this.interpreter=new lt,this.stdlib=new ye(e,this.parser,this.interpreter),this.lastWorkingProgram=P([]),this.workingCount=0,this.currentProgram=P([]),this.runtimeErrors=[]}var e,n,r;return e=t,(n=[{key:"resetToLastWorkingProgram",value:function(){this.currentProgram=this.lastWorkingProgram,this.workingCount=0}},{key:"evaluate",value:function(t){try{this.runtimeErrors=[];var e=this.parser.parse(t);if(e.errors.length<1)this.eventBus&&this.eventBus.emit("clear-error"),this.currentProgram=e.ast,this.workingCount=0;else{var n=e.errors.length,r=1===n?"1 Error!":"".concat(n," Errors!");this.eventBus&&this.eventBus.emit("display-error",new Error(r))}}catch(t){this.eventBus&&this.eventBus.emit("display-error",t)}return this.runtimeErrors}},{key:"genAnimateFunc",value:function(t){var e=this;return this.gfx.init(),this.evaluate(t||""),function(t){e.gfx.begin(),e.stdlib.setTime(t);var n=e.interpreter.run(e.currentProgram,e.stdlib.scope);return e.gfx.end(),0===n.exitCode?(e.workingCount+=1,10===e.workingCount&&(e.lastWorkingProgram=e.currentProgram)):(e.workingCount=0,e.currentProgram=e.lastWorkingProgram,e.runtimeErrors=n.errors),e.runtimeErrors}}}])&&ge(e.prototype,n),r&&ge(e,r),t}();function xe(t){return(xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function we(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ee(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Pe(t,e)}function Se(t){var e=_e();return function(){var n,r=Fe(t);if(e){var i=Fe(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Te(this,n)}}function Te(t,e){return!e||"object"!==xe(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Ae(t){var e="function"==typeof Map?new Map:void 0;return(Ae=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return Re(t,arguments,Fe(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Pe(r,t)})(t)}function Re(t,e,n){return(Re=_e()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&Pe(i,n.prototype),i}).apply(null,arguments)}function _e(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function Pe(t,e){return(Pe=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Fe(t){return(Fe=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Oe=function(t){Ee(n,t);var e=Se(n);function n(t){return we(this,n),e.call(this,t)}return n}(Ae(Error)),Ne=function(t){Ee(n,t);var e=Se(n);function n(t,r){return we(this,n),e.call(this,"Shader Error - ".concat(t," shader: ").concat(r))}return n}(Oe),Ce=function(t){Ee(n,t);var e=Se(n);function n(t,r){return we(this,n),e.call(this,"Material Error - ".concat(t," material: ").concat(r))}return n}(Oe),Le=function(t){Ee(n,t);var e=Se(n);function n(t,r){return we(this,n),e.call(this,"PostProcessing Error - ".concat(t," stage: ").concat(r))}return n}(Oe);function Ue(t,e,n,r){var i=t.createShader(t.VERTEX_SHADER);if(null===i)throw new Ne(e,"WebGL could not create vertex shader");if(t.shaderSource(i,n),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS))throw new Ne(e,"Could not compile vertex shader: ".concat(t.getShaderInfoLog(i)));var o=t.createShader(t.FRAGMENT_SHADER);if(null===o)throw new Ne(e,"WebGL could not create fragment shader");if(t.shaderSource(o,r),t.compileShader(o),!t.getShaderParameter(o,t.COMPILE_STATUS))throw new Ne(e,"Could not compile fragment shader: ".concat(t.getShaderInfoLog(o)));var a=t.createProgram();if(t.attachShader(a,i),t.attachShader(a,o),t.linkProgram(a),!t.getProgramParameter(a,t.LINK_STATUS))throw new Ne(e,"Could not compile shader program: ".concat(t.getShaderInfoLog(a)));return a}var Me=n(1),De={vertices:[-1,-1,0,1,-1,0,1,1,0,-1,1,0],indices:[0,3,2,0,2,1],texture:[0,0,1,0,1,1,0,1]};function Be(t){var e=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,e),t.bufferData(t.ARRAY_BUFFER,new Float32Array(De.vertices),t.STATIC_DRAW);var n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,new Float32Array(De.texture),t.STATIC_DRAW);var r=t.createBuffer();return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(De.indices),t.STATIC_DRAW),{vertex:e,texture:n,index:r,geometries:De}}function Ie(t,e,n){var r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.RGB,e,n,0,t.RGB,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),r}function je(t,e,n){var r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.DEPTH_COMPONENT24,e,n,0,t.DEPTH_COMPONENT,t.UNSIGNED_INT,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),r}function ze(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var We=function(){function t(e,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.gl=e;var i=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,i),this.framebuffer=i;var o=je(e,n,r);e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,o,0);var a=Ie(e,n,r);e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,a,0),this.textures={draw:a,depth:o},this.texture=a;var u=Be(e);this.quad=u;var c=Ue(e,Me.savebuffer.name,Me.savebuffer.vertexShader,Me.savebuffer.fragmentShader);this.program=c;var s=e.getAttribLocation(c,"position");if(null===s)throw new Le("Save","WebGL could not get position attribute location");var f=e.getAttribLocation(c,"texcoord");if(null===f)throw new Le("Save","WebGL could not get position attribute location");this.attributes={position:s,textureCoord:f};var l=e.getUniformLocation(c,"Texture");if(null===l)throw new Le("Save","WebGL could not get position attribute location");this.uniforms={Texture:l}}var e,n,r;return e=t,(n=[{key:"render",value:function(){var t=this.gl;t.useProgram(this.program),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.textures.draw),t.uniform1i(this.uniforms.Texture,0),t.bindBuffer(t.ARRAY_BUFFER,this.quad.vertex),t.vertexAttribPointer(this.attributes.position,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(this.attributes.position),t.bindBuffer(t.ARRAY_BUFFER,this.quad.texture),t.vertexAttribPointer(this.attributes.textureCoord,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(this.attributes.textureCoord),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.quad.index),t.drawElements(t.TRIANGLES,this.quad.geometries.indices.length,t.UNSIGNED_SHORT,0)}}])&&ze(e.prototype,n),r&&ze(e,r),t}(),Ge=n(2);function Xe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Ve=function(){function t(e,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.gl=e;var i=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,i),this.framebuffer=i;var o=je(e,n,r);e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,o,0);var a=Ie(e,n,r);e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,a,0),this.textures={draw:a,depth:o},this.texture=a;var u=Be(e);this.quad=u;var c=Ue(e,Ge.paintover.name,Ge.paintover.vertexShader,Ge.paintover.fragmentShader);this.program=c;var s=e.getAttribLocation(c,"position");if(null===s)throw new Le("PaintOver","WebGL could not get position attribute location");var f=e.getAttribLocation(c,"texcoord");if(null===f)throw new Le("PaintOver","WebGL could not get texcoord attribute location");this.attributes={position:s,textureCoord:f};var l=e.getUniformLocation(c,"newFrame");if(null===l)throw new Le("PaintOver","WebGL could not get newFrame uniform location");var h=e.getUniformLocation(c,"lastFrame");if(null===h)throw new Le("PaintOver","WebGL could not get lastFrame uniform location");var p=e.getUniformLocation(c,"depth");if(null===p)throw new Le("PaintOver","WebGL could not get depth uniform location");this.uniforms={LastFrame:h,NewFrame:l,NewDepth:p}}var e,n,r;return e=t,(n=[{key:"render",value:function(t,e,n){var r=this.gl;r.useProgram(this.program),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,t),r.uniform1i(this.uniforms.LastFrame,0),r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,e),r.uniform1i(this.uniforms.NewFrame,1),r.activeTexture(r.TEXTURE2),r.bindTexture(r.TEXTURE_2D,n),r.uniform1i(this.uniforms.NewDepth,2),r.bindBuffer(r.ARRAY_BUFFER,this.quad.vertex),r.vertexAttribPointer(this.attributes.position,3,r.FLOAT,!1,0,0),r.enableVertexAttribArray(this.attributes.position),r.bindBuffer(r.ARRAY_BUFFER,this.quad.texture),r.vertexAttribPointer(this.attributes.textureCoord,2,r.FLOAT,!1,0,0),r.enableVertexAttribArray(this.attributes.textureCoord),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.quad.index),r.drawElements(r.TRIANGLES,this.quad.geometries.indices.length,r.UNSIGNED_SHORT,0)}}])&&Xe(e.prototype,n),r&&Xe(e,r),t}();function Ye(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var He=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.canvas=e,this.gl=n,this.defaultFramebuffer=null,this.inputPass=new We(n,e.width,e.height),this.paintOverPass=new Ve(n,e.width,e.height),this.blendedPass=new We(n,e.width,e.height),this.outputPass=new We(n,e.width,e.height)}var e,n,r;return e=t,(n=[{key:"use",value:function(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.inputPass.framebuffer)}},{key:"render",value:function(t){switch(t){case"paintOver":this.renderPaintOver();break;default:this.renderNormal()}}},{key:"renderPaintOver",value:function(){var t=this.gl;t.disable(t.DEPTH_TEST),t.disable(t.CULL_FACE),t.viewport(0,0,this.canvas.width,this.canvas.height),t.bindFramebuffer(t.FRAMEBUFFER,this.blendedPass.framebuffer),this.paintOverPass.render(this.outputPass.textures.draw,this.inputPass.textures.draw,this.inputPass.textures.depth),t.bindFramebuffer(t.FRAMEBUFFER,this.outputPass.framebuffer),this.blendedPass.render(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.defaultFramebuffer),this.outputPass.render()}},{key:"renderNormal",value:function(){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,this.outputPass.framebuffer),this.inputPass.render(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.defaultFramebuffer),this.outputPass.render()}},{key:"skip",value:function(){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,this.defaultFramebuffer)}}])&&Ye(e.prototype,n),r&&Ye(e,r),t}();function qe(t,e){var n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e.vertices),t.STATIC_DRAW);var r=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e.barycentrics),t.STATIC_DRAW);var i=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e.texture),t.STATIC_DRAW);var o=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e.normals),t.STATIC_DRAW);var a=t.createBuffer();return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(e.indices),t.STATIC_DRAW),{vertex:n,wireframe:r,texture:i,normals:o,index:a}}function $e(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.split("\n"),i=[],o=[],a=[],u=[];r.forEach((function(t){switch(t.substr(0,2)){case"v ":i.push(t.substr(2).split(" ").map((function(t){return parseFloat(t)})));break;case"vt":u.push(t.substr(3).split(" ").map((function(t){return parseFloat(t)})));break;case"vn":a.push(t.substr(3).split(" ").map((function(t){return parseFloat(t)})));break;case"f ":o.push(t.substr(2).split(" "))}}));var c={name:t,vertices:[],indices:[],barycentrics:[],texture:[],normals:[]},s=0;o.forEach((function(t){t.forEach((function(t){var e=t.split("/").map((function(t){return parseInt(t,10)}));(i[e[0]-1].forEach((function(t){return c.vertices.push(t)})),c.indices.push(s),s+=1,e[1])&&u[e[1]-1].forEach((function(t){return c.texture.push(t)}));e[2]&&a[e[2]-1].forEach((function(t){return c.normals.push(t)}))}))}));for(var f=n?1:0,l=c.vertices.length/3,h=0;h<l;h+=1)h%2?c.barycentrics.push(0,f,1,1,0,0,0,1,0):c.barycentrics.push(0,f,1,0,1,0,1,0,0);return c}function Ke(t){var e=[],n={},r=$e("triangle","v 0 0.5 0\nv 0.5 -0.5 0\nv -0.5 -0.5 0\n\nf 1/1 2/2 3/3\n\nvt 0 0\nvt 0 1\nvt 1 1\n",!1);Ze(r);var i=$e("rectangle","v -0.5 -0.5 0\nv 0.5 -0.5 0\nv 0.5 0.5 0\nv -0.5 0.5 0\n\nf 1/1 2/2 3/3\nf 1/1 3/3 4/4\n\nvt 0 0\nvt 0 1\nvt 1 1\nvt 1 0\n",!0);Ze(i);var o=$e("cube","v 0.5 0.5 0.5\nv -0.5 0.5 0.5\nv -0.5 0.5 -0.5\nv 0.5 0.5 -0.5\nv 0.5 -0.5 0.5\nv -0.5 -0.5 0.5\nv -0.5 -0.5 -0.5\nv 0.5 -0.5 -0.5\n\nf 1/1 2/2 3/3\nf 1/1 3/3 4/4\nf 1/1 5/2 6/3\nf 1/1 6/3 2/4\nf 2/1 6/2 7/3\nf 2/1 7/3 3/4\nf 3/1 7/2 8/3\nf 3/1 8/3 4/4\nf 4/1 8/2 5/3\nf 4/1 5/3 1/4\nf 5/1 8/2 7/3\nf 5/1 7/3 6/4\n\nvt 0 0\nvt 0 1\nvt 1 1\nvt 1 0\n",!0);Ze(o);var a=$e("cylinder","# front face\nv 0.0 0.0 0.5\nv 0.0 0.5 0.5\nv 0.35355338 0.35355338 0.5\nv 0.5 0 0.5\nv 0.35355338 -0.35355338 0.5\nv 0 -0.5 0.5\nv -0.35355344 -0.35355332 0.5\nv -0.5 0 0.5\nv -0.35355327 0.3535535 0.5\n# rear face\nv 0.0 0.0 -0.5\nv 0.0 0.5 -0.5\nv -0.35355327 0.3535535 -0.5\nv -0.5 0 -0.5\nv -0.35355344 -0.35355332 -0.5\nv 0 -0.5 -0.5\nv 0.35355338 -0.35355338 -0.5\nv 0.5 0 -0.5\nv 0.35355338 0.35355338 -0.5\n\n# front face\nf 1/1 2/2 3/3\nf 1/1 3/3 4/4\nf 1/1 4/2 5/3\nf 1/1 5/3 6/4\nf 1/1 6/2 7/3\nf 1/1 7/3 8/4\nf 1/1 8/2 9/3\nf 1/1 9/3 2/4\n# sides\nf 2/1 11/2 18/3\nf 2/1 18/3 3/4\nf 3/1 18/2 17/3\nf 3/1 17/3 4/4\nf 4/1 17/2 16/3\nf 4/1 16/3 5/4\nf 5/1 16/2 15/3\nf 5/1 15/3 6/4\nf 6/1 15/2 14/3\nf 6/1 14/3 7/4\nf 7/1 14/2 13/3\nf 7/1 13/3 8/4\nf 8/1 13/2 12/3\nf 8/1 12/3 9/4\nf 9/1 12/2 11/3\nf 9/1 11/3 2/4\n# rear face\nf 10/1 11/2 12/3\nf 10/1 12/3 13/4\nf 10/1 13/2 14/3\nf 10/1 14/3 15/4\nf 10/1 15/2 16/3\nf 10/1 16/3 17/4\nf 10/1 17/2 18/3\nf 10/1 18/3 11/4\n\nvt 0 0\nvt 0 1\nvt 1 1\nvt 1 0\n",!0);Ze(a);var u=$e("sphere","v 0.0 0.0 0.5\nv 0.0 0.25 0.4330127\nv 0.125 0.21650635 0.4330127\nv 0.21650636 0.12499999 0.4330127\nv 0.25 0 0.4330127\nv 0.21650635 -0.12500001 0.4330127\nv 0.12500001 -0.21650635 0.4330127\nv 0 -0.25 0.4330127\nv -0.12500004 -0.21650632 0.4330127\nv -0.21650636 -0.12499998 0.4330127\nv -0.25 0 0.4330127\nv -0.21650636 0.12499998 0.4330127\nv -0.12499994 0.21650639 0.4330127\nv 0.0 0.43301272 0.24999999\nv 0.21650636 0.375 0.24999999\nv 0.37500003 0.21650635 0.24999999\nv 0.43301272 0 0.24999999\nv 0.375 -0.21650639 0.24999999\nv 0.21650639 -0.375 0.24999999\nv 0 -0.43301272 0.24999999\nv -0.21650644 -0.37499997 0.24999999\nv -0.37500003 -0.21650632 0.24999999\nv -0.43301272 0 0.24999999\nv -0.37500003 0.21650632 0.24999999\nv -0.21650626 0.3750001 0.24999999\nv 0.0 0.5 0\nv 0.25 0.4330127 0\nv 0.43301272 0.24999999 0\nv 0.5 0 0\nv 0.4330127 -0.25000003 0\nv 0.25000003 -0.4330127 0\nv 0 -0.5 0\nv -0.2500001 -0.43301263 0\nv -0.43301272 -0.24999996 0\nv -0.5 0 0\nv -0.43301272 0.24999996 0\nv -0.24999988 0.43301278 0\nv 0.0 0.4330127 -0.25000003\nv 0.21650635 0.375 -0.25000003\nv 0.375 0.21650633 -0.25000003\nv 0.4330127 0 -0.25000003\nv 0.375 -0.21650638 -0.25000003\nv 0.21650638 -0.375 -0.25000003\nv 0 -0.4330127 -0.25000003\nv -0.21650642 -0.37499994 -0.25000003\nv -0.375 -0.2165063 -0.25000003\nv -0.4330127 0 -0.25000003\nv -0.375 0.2165063 -0.25000003\nv -0.21650624 0.37500006 -0.25000003\n\nv 0.0 0.25000003 -0.4330127\nv 0.12500001 0.21650638 -0.4330127\nv 0.21650639 0.125 -0.4330127\nv 0.25000003 0 -0.4330127\nv 0.21650638 -0.12500003 -0.4330127\nv 0.12500003 -0.21650638 -0.4330127\nv 0 -0.25000003 -0.4330127\nv -0.12500006 -0.21650635 -0.4330127\nv -0.21650639 -0.12499999 -0.4330127\nv -0.25000003 0 -0.4330127\nv -0.21650639 0.12499999 -0.4330127\nv -0.124999955 0.21650642 -0.4330127\nv 0.0 0.0 -0.5\n\n# first layer\nf 1/1 2/2 3/3\nf 1/1 3/3 4/4\nf 1/1 4/2 5/3\nf 1/1 5/3 6/4\nf 1/1 6/2 7/3\nf 1/1 7/3 8/4\nf 1/1 8/2 9/3\nf 1/1 9/3 10/4\nf 1/1 10/2 11/3\nf 1/1 11/3 12/4\nf 1/1 12/2 13/3\nf 1/1 13/3 2/4\n\n# second layer\nf 2/1 14/3 15/4\nf 2/1 15/2 3/3\nf 3/1 15/3 16/4\nf 3/1 16/2 4/3\nf 4/1 16/3 17/4\nf 4/1 17/2 5/3\nf 5/1 17/3 18/4\nf 5/1 18/2 6/3\nf 6/1 18/3 19/4\nf 6/1 19/2 7/3\nf 7/1 19/3 20/4\nf 7/1 20/2 8/3\nf 8/1 20/3 21/4\nf 8/1 21/2 9/3\nf 9/1 21/3 22/4\nf 9/1 22/2 10/3\nf 10/1 22/3 23/4\nf 10/1 23/2 11/3\nf 11/1 23/3 24/4\nf 11/1 24/2 12/3\nf 12/1 24/3 25/4\nf 12/1 25/2 13/3\nf 13/1 25/3 14/4\nf 13/1 14/2 2/3\nf 14/1 26/3 27/4\nf 14/1 27/2 15/3\nf 15/1 27/3 28/4\nf 15/1 28/2 16/3\nf 16/1 28/3 29/4\nf 16/1 29/2 17/3\nf 17/1 29/3 30/4\nf 17/1 30/2 18/3\nf 18/1 30/3 31/4\nf 18/1 31/2 19/3\nf 19/1 31/3 32/4\nf 19/1 32/2 20/3\nf 20/1 32/3 33/4\nf 20/1 33/2 21/3\nf 21/1 33/3 34/4\nf 21/1 34/2 22/3\nf 22/1 34/3 35/4\nf 22/1 35/2 23/3\nf 23/1 35/3 36/4\nf 23/1 36/2 24/3\nf 24/1 36/3 37/4\nf 24/1 37/2 25/3\nf 25/1 37/3 26/4\nf 25/1 26/2 14/3\nf 26/1 38/3 39/4\nf 26/1 39/2 27/3\nf 27/1 39/3 40/4\nf 27/1 40/2 28/3\nf 28/1 40/3 41/4\nf 28/1 41/2 29/3\nf 29/1 41/3 42/4\nf 29/1 42/2 30/3\nf 30/1 42/3 43/4\nf 30/1 43/2 31/3\nf 31/1 43/3 44/4\nf 31/1 44/2 32/3\nf 32/1 44/3 45/4\nf 32/1 45/2 33/3\nf 33/1 45/3 46/4\nf 33/1 46/2 34/3\nf 34/1 46/3 47/4\nf 34/1 47/2 35/3\nf 35/1 47/3 48/4\nf 35/1 48/2 36/3\nf 36/1 48/3 49/4\nf 36/1 49/2 37/3\nf 37/1 49/3 38/4\nf 37/1 38/2 26/3\nf 38/1 50/3 51/4\nf 38/1 51/2 39/3\nf 39/1 51/3 52/4\nf 39/1 52/2 40/3\nf 40/1 52/3 53/4\nf 40/1 53/2 41/3\nf 41/1 53/3 54/4\nf 41/1 54/2 42/3\nf 42/1 54/3 55/4\nf 42/1 55/2 43/3\nf 43/1 55/3 56/4\nf 43/1 56/2 44/3\nf 44/1 56/3 57/4\nf 44/1 57/2 45/3\nf 45/1 57/3 58/4\nf 45/1 58/2 46/3\nf 46/1 58/3 59/4\nf 46/1 59/2 47/3\nf 47/1 59/3 60/4\nf 47/1 60/2 48/3\nf 48/1 60/3 61/4\nf 48/1 61/2 49/3\nf 49/1 61/3 50/4\nf 49/1 50/2 38/3\nf 62/3 50/1 61/4\nf 62/2 61/1 60/3\nf 62/3 60/1 59/4\nf 62/2 59/1 58/3\nf 62/3 58/1 57/4\nf 62/2 57/1 56/3\nf 62/3 56/1 55/4\nf 62/2 55/1 54/3\nf 62/3 54/1 53/4\nf 62/2 53/1 52/3\nf 62/3 52/1 51/4\nf 62/2 51/1 50/3\n\nvt 0 0\nvt 0 1\nvt 1 1\nvt 1 0\n",!0);return Ze(u),[r,i,o,a,u].forEach((function(r){try{var i=function(t,e){return{buffers:qe(t,e),geometry:e}}(t,r);n[r.name]=i}catch(t){e.push(t)}})),{errors:e,geometries:n}}function Ze(t){if(t.normals.length<1)for(var e=t.vertices,n=0;n<e.length;n+=9){var r=Je([e[n+0],e[n+1],e[n+2]],[e[n+3],e[n+4],e[n+5]],[e[n+6],e[n+7],e[n+8]]);r.forEach((function(e){return t.normals.push(e)})),r.forEach((function(e){return t.normals.push(e)})),r.forEach((function(e){return t.normals.push(e)}))}}function Je(t,e,n){return Nt(Ft(t,e),Ft(e,n))}var Qe=n.p+"algorave.png",tn=n.p+"crystal.bmp";function en(t){var e=[],n={};return[Qe,tn].forEach((function(r){try{var i=function(t,e){var n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n);var r=t.RGBA,i=t.RGBA,o=t.UNSIGNED_BYTE,a=new Uint8Array([0,0,255,255]);t.texImage2D(t.TEXTURE_2D,0,r,1,1,0,i,o,a);var u=new Image;return u.onload=function(){t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,r,i,o,u),nn(u.width)&&nn(u.height)?t.generateMipmap(t.TEXTURE_2D):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR))},u.src=e,n}(t,r),o=r.split(".")[0];n[o]=i}catch(t){e.push(t)}})),{errors:e,textures:n}}function nn(t){return 0==(t&t-1)}var rn=n(7),on=n(8),an=n(9),un=n(10),cn=n(11),sn=n(12);function fn(t){var e=[],n={};return[rn.material,on.material,an.material,un.material,cn.material,sn.material].forEach((function(r){try{var i=function(t,e){var n=Ue(t,e.name,e.vertexShader,e.fragmentShader),r={};e.attributes.forEach((function(i){var o=t.getAttribLocation(n,i);if(null===o)throw new Ce(e.name,"WebGL could not get ".concat(i," attribute."));r[i]=o}));var i={};return e.uniforms.forEach((function(r){var o=t.getUniformLocation(n,r);if(null===o)throw new Ce(e.name,"WebGL could not get ".concat(r," uniform."));i[r]=o})),{name:e.name,program:n,attributes:r,uniforms:i}}(t,r);n[i.name]=i}catch(t){e.push(t)}})),{errors:e,materials:n}}function ln(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var hn=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.stack=[e],this.position=0,this.snapshotPositions=[]}var e,n,r;return e=t,(n=[{key:"push",value:function(t){this.position+=1,this.stack[this.position]=t}},{key:"pushMod",value:function(t,e){var n=this.top();this.push(e(n,t))}},{key:"top",value:function(){return this.stack[this.position]}},{key:"pop",value:function(){var t=this.top();return this.position-=1,t}},{key:"pushSnapshot",value:function(){this.snapshotPositions.push(this.position)}},{key:"popSnapshot",value:function(){var t=this.snapshotPositions.pop();this.position=t}},{key:"reset",value:function(){this.position=0}}])&&ln(e.prototype,n),r&&ln(e,r),t}();function pn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var vn=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.default=e,this.current=e,this.setLastFrame=!1,this.useCurrent=!1}var e,n,r;return e=t,(n=[{key:"set",value:function(t){this.current=t,this.setLastFrame=!0,this.useCurrent=!0}},{key:"get",value:function(){return this.useCurrent?this.current:this.default}},{key:"reset",value:function(){this.useCurrent=this.setLastFrame,this.setLastFrame=!1}}])&&pn(e.prototype,n),r&&pn(e,r),t}();function mn(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],r=!0,i=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==u.return||u.return()}finally{if(i)throw o}}return n}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return bn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return bn(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function bn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function dn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var yn=function(){function t(e,n){var r,i,o,a,u,c,s,f,l,h,p;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.canvas=e,this.canvas.width=e.clientWidth,this.canvas.height=e.clientHeight,this.gl=n,this.pMatrix=(r=.1,i=100,o=45,a=this.canvas.width/this.canvas.height,u=At(.5*o*_t),[1/(a*u),0,0,0,0,1/u,0,0,0,0,-(i+r)/(i-r),1/(.5/i-.5/r),0,0,-1,0]),this.vMatrix=(c=Pt(0,0,10),s=Pt(0,0,0),f=Pt(0,1,0),l=Ot(Ft(s,c)),h=Ot(Nt(l,f)),p=Nt(h,l),[h[0],h[1],h[2],-Ct(h,c),p[0],p[1],p[2],-Ct(p,c),-l[0],-l[1],-l[2],Ct(l,c),0,0,0,1]),this.matrixStack=new hn([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.fillStack=new hn({style:"fill",color:[1,1,1,1]}),this.strokeStack=new hn({style:"stroke",color:[0,0,0,1]}),this.strokeSizeStack=new hn(.02),this.materialStack=new hn("basic"),this.textureStack=new hn("crystal"),this.background=new vn([1,1,1]),this.depthCheck=new vn(!0),this.renderMode=new vn("normal");var v=Ke(this.gl);v.errors.forEach((function(t){return console.log(t)})),this.geometries=v.geometries;var m=fn(this.gl);m.errors.forEach((function(t){return console.log(t)})),this.materials=m.materials;var b=en(this.gl);b.errors.forEach((function(t){return console.log(t)})),this.textures=b.textures,this.postProcessing=new He(this.canvas,this.gl)}var e,n,r;return e=t,(n=[{key:"pushSnapshot",value:function(){this.matrixStack.pushSnapshot(),this.fillStack.pushSnapshot(),this.strokeStack.pushSnapshot(),this.strokeSizeStack.pushSnapshot(),this.materialStack.pushSnapshot(),this.textureStack.pushSnapshot()}},{key:"popSnapshot",value:function(){this.matrixStack.popSnapshot(),this.fillStack.popSnapshot(),this.strokeStack.popSnapshot(),this.strokeSizeStack.popSnapshot(),this.materialStack.popSnapshot(),this.textureStack.pushSnapshot()}},{key:"getFillColor",value:function(){var t=this.fillStack.top();return"fill"===t.style?t.color:[0,0,0,0]}},{key:"getStrokeColor",value:function(t){var e=this.strokeStack.top();return"stroke"===e.style?e.color:t}},{key:"getTexture",value:function(){var t=this.textureStack.top(),e=this.textures[t];return null!=e?e:this.textures.crystal}},{key:"setUniform",value:function(t,e){switch(t){case"Pmatrix":this.gl.uniformMatrix4fv(e,!0,this.pMatrix);break;case"Vmatrix":this.gl.uniformMatrix4fv(e,!0,this.vMatrix);break;case"Mmatrix":this.gl.uniformMatrix4fv(e,!0,this.matrixStack.top());break;case"Color":this.gl.uniform4fv(e,this.getFillColor());break;case"WireColor":this.gl.uniform4fv(e,this.getStrokeColor(this.getFillColor()));break;case"StrokeSize":this.gl.uniform1f(e,this.strokeSizeStack.top());break;case"Texture":this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.getTexture()),this.gl.uniform1i(e,0);break;default:console.log("".concat(t," is an unknown uniform location"))}}},{key:"setAttribute",value:function(t,e,n){switch(t){case"position":this.gl.bindBuffer(this.gl.ARRAY_BUFFER,n.vertex),this.gl.vertexAttribPointer(e,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(e);break;case"normals":this.gl.bindBuffer(this.gl.ARRAY_BUFFER,n.normals),this.gl.vertexAttribPointer(e,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(e);break;case"barycentric":this.gl.bindBuffer(this.gl.ARRAY_BUFFER,n.wireframe),this.gl.vertexAttribPointer(e,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(e);break;case"textureCoord":this.gl.bindBuffer(this.gl.ARRAY_BUFFER,n.texture),this.gl.vertexAttribPointer(e,2,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(e)}}},{key:"drawShape",value:function(t){var e=this,n=this.gl,r=this.materialStack.top(),i=this.materials[r];if(i){var o=this.geometries[t];o&&(n.useProgram(i.program),Object.entries(i.uniforms).forEach((function(t){var n=mn(t,2),r=n[0],i=n[1];return e.setUniform(r,i)})),Object.entries(i.attributes).forEach((function(t){var n=mn(t,2),r=n[0],i=n[1];return e.setAttribute(r,i,o.buffers)})),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,o.buffers.index),n.cullFace(n.FRONT),n.drawElements(n.TRIANGLES,o.geometry.indices.length,n.UNSIGNED_SHORT,0),n.cullFace(n.BACK),n.drawElements(n.TRIANGLES,o.geometry.indices.length,n.UNSIGNED_SHORT,0))}}},{key:"init",value:function(){this.begin(),this.end()}},{key:"begin",value:function(){var t=this.gl;this.postProcessing.use(),this.matrixStack.reset(),this.fillStack.reset(),this.strokeStack.reset(),this.strokeSizeStack.reset(),this.materialStack.reset(),this.textureStack.reset(),this.background.reset(),this.depthCheck.reset(),this.renderMode.reset(),t.frontFace(t.CW),t.enable(t.CULL_FACE),this.depthCheck.get()?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA);var e=mn(this.background.get(),3),n=e[0],r=e[1],i=e[2];t.clearColor(n,r,i,1),t.clearDepth(1),t.viewport(0,0,this.canvas.width,this.canvas.height),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)}},{key:"end",value:function(){var t=this.renderMode.get();this.postProcessing.render(t)}}])&&dn(e.prototype,n),r&&dn(e,r),t}();function gn(t){var e=t.getContext("webgl2");if(!e)return{status:"error",message:"Could not create WebGL2 context"};var n=new yn(t,e);return{status:"ok",improviz:new ke(n)}}}]);